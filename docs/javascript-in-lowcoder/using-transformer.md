è½¬æ¢å™¨ (Transformer)

è½¬æ¢å™¨ (Transformer) æ”¯æŒç¼–å†™å¤šè¡Œ JavaScript ä»£ç ï¼Œå¸®åŠ©æˆ‘ä»¬å®žçŽ°æŸ¥è¯¢/ç»„ä»¶/ä¸´æ—¶çŠ¶æ€ç­‰æ•°æ®çš„è½¬æ¢ä»¥åŠæ–¹æ³•çš„å¤ç”¨ã€‚ä¸Ž [JavaScript è¡¨è¾¾å¼](../javascript-in-lowcoder/writing-javascript.md)â€‹`{{ }}`â€‹ ä¸åŒï¼Œè½¬æ¢å™¨æ”¯æŒå¤šè¡Œ JS ä»£ç ã€‚ä¸Ž [JavaScript æŸ¥è¯¢](../javascript-in-lowcoder/javascript-query.md)ä¸åŒï¼Œè½¬æ¢å™¨ä¸­åªæ”¯æŒåªè¯»æ“ä½œï¼Œä¸èƒ½ä¿®æ”¹å¼•ç”¨æ•°æ®çš„å€¼æˆ–è€…è§¦å‘æŸ¥è¯¢ç­‰ã€‚æ­¤å¤–ï¼Œè½¬æ¢å™¨ä¾èµ–çš„æ•°æ®å˜åŒ–æ—¶ï¼Œå®ƒçš„å€¼å°†â€‹**è‡ªåŠ¨æ›´æ–°**â€‹ã€‚

## å¿«é€Ÿä¸Šæ‰‹

ç‚¹å‡»æŸ¥è¯¢ç¼–è¾‘å™¨é¢æ¿çš„â€‹**æ–°å»º-&gt;è½¬æ¢å™¨**â€‹ï¼š

![](../assets/1-20231002175907-8v0om4o.png)â€‹

æ–°å»ºä¹‹åŽå¯ä»¥ç¼–å†™ JS è¯­å¥ï¼Œç‚¹å‡»**é¢„è§ˆ**å¯ä»¥é¢„è§ˆä»£ç è¿ç®—çš„ç»“æžœï¼Œæœ€åŽçš„è¿”å›žå€¼å°†æˆä¸ºè½¬æ¢å™¨çš„å€¼ (`transformer1.value`â€‹)ï¼Œå¯ä»¥åœ¨åº”ç”¨å†…è¢«å¼•ç”¨ï¼š

![](../assets/2-20231002175907-d3f3fun.png)â€‹

> #### ðŸ’¡ è¯´æ˜Ž
>
> æŸ¥è¯¢/ç»„ä»¶æˆ–è€…å…¨å±€çŠ¶æ€ä¸­çš„æ•°æ®ï¼Œå¦‚ï¼š`input1.valuequery1.datastate1.value`â€‹ ç­‰ï¼Œåœ¨è½¬æ¢å™¨ä¸­æ—¶å¯ä»¥ç›´æŽ¥å¼•ç”¨ï¼Œ**æ— éœ€åŠ **â€‹`{{ }}`â€‹ã€‚

## æ•°æ®åªè¯»

è½¬æ¢å™¨ä¸­ä¸èƒ½ä¿®æ”¹æŸ¥è¯¢/ç»„ä»¶/ä¸´æ—¶çŠ¶æ€çš„å€¼ï¼Œä¹Ÿä¸èƒ½è§¦å‘æŸ¥è¯¢ç­‰ï¼Œå¦‚éœ€ä¸Šè¿°åŠŸèƒ½å¯ä»¥ç¼–å†™ [JS æŸ¥è¯¢](javascript-query.md)ã€‚

å¦‚ä¸‹æ‰€ç¤ºï¼Œtransformer1 å¸Œæœ›å°† restApiQuery çš„æ•°æ®æŒ‰ç…§ age å­—æ®µæŽ’åºå¹¶è¿”å›žï¼Œå› ä¸º sort æ–¹æ³•ä¼šä¿®æ”¹åŽŸå§‹æ•°æ® `restApiQuery.data`â€‹ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚

![](../assets/3-20231002175907-u2mmmmj.png)â€‹

æ­¤å¤„å¯ä»¥ä½¿ç”¨ [lodash](../javascript-in-lowcoder/using-array.md#%E4%BD%BF%E7%94%A8lodash%E6%93%8D%E4%BD%9C%E6%95%B0%E7%BB%84) çš„ `_.orderBy()`â€‹ æ–¹æ³•ï¼š

![](../assets/4-20231002175907-tkas9bq.png)â€‹

## ä½¿ç”¨ä¸¾ä¾‹

### ç¼–å†™æ³¨é‡Š

â€‹`//`â€‹ åŽç¼–å†™æ³¨é‡Šï¼š

```javascript
//è¿”å›žç”¨æˆ·å§“å
return currentUser.name
```

### è¿”å›žæ•°æ®

è¦ä»Žè½¬æ¢å™¨è¿”å›žæ•°æ®ï¼Œè¯·ä½¿ç”¨`return`â€‹ è¯­å¥ï¼š

```javascript
const val = input1.value
return val * 5
```

### è½¬åŒ–æ—¶é—´æˆ³æ ¼å¼

å°†æŸ¥è¯¢è¿”å›žçš„æ•°æ® `query1.data`â€‹ æ—¶é—´åˆ— `start_time`â€‹ çš„æ—¶é—´æˆ³ï¼Œåˆ©ç”¨ `moment().format()`â€‹ å‡½æ•°è½¬æ¢ä¸º `YYYY-MM-DD`â€‹ æ ¼å¼ï¼š

```javascript
return query1.data.map(it => {
    return {
        ...it,
        start_time: moment(it.start_time).format('YYYY-MM-DD')
    };
})
```

### ä½¿ç”¨æŸ¥è¯¢æ•°æ®

#### å¯¹æŸ¥è¯¢æ•°æ®åšè¿ç®—

è¦å¯¹æŸ¥è¯¢å¾—åˆ°çš„å¯¹è±¡æ•°ç»„ä¸­çš„éƒ¨åˆ†æ•°æ®åšè¿ç®—ï¼Œå¯ä»¥ä½¿ç”¨ `map()`â€‹ å‡½æ•°ã€‚å¦‚ä¸‹ï¼Œå¯¹æŸ¥è¯¢è¿”å›žçš„å¯¹è±¡æ•°ç»„çš„ `price`â€‹ åˆ—æ‰€æœ‰æ•°æ®åš +5 è¿ç®—ï¼š

```javascript
const data = query1.data
return data.map(x => x.price + 5)
```

#### å¯¹ API æŸ¥è¯¢ç»“æžœæŽ’åº

ä½¿ç”¨ `._orderBy()`â€‹ å‡½æ•°å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒæŽ’åºï¼Œä¸‹é¢ä»£ç å¯ä»¥å°† `query4`â€‹ çš„æ•°æ®æŒ‰ç…§ `amount`â€‹ åˆ—çš„å‡åºè¿”å›žï¼š

```javascript
return _.orderBy(query4.data, 'amount', 'asc')
```

#### åˆå¹¶æŸ¥è¯¢æ•°æ®

ä½¿ç”¨è½¬æ¢å™¨å¯ä»¥å°†å¤šä¸ªæŸ¥è¯¢çš„ç»“æžœåˆå¹¶åˆ°ä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `_.zipWith()`â€‹ å‡½æ•°ï¼š

```javascript
var sqlData = query1.data;
var apiData = query2.data;

return _.zipWith(
    sqlData,
    apiData,
    (sql, api) => Object.assign({}, api, sql)
)
```